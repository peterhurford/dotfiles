class window.AdminPromotionViewModel extends PromotionViewModel
  constructor: ->
    super
    @initialize_observables ["productId", @product_id], ["productType", @product_type]

  build_add_data: (coupon_code) ->
    # Overrides PromotionViewModel
    coupon_code: coupon_code
    product_id: @productId
    product_type: @productType

  build_remove_data: (promotion) ->
    # Overrides PromotionViewModel
    promotion_id: promotion.id
    product_id: @productId
    product_type: @productType

  build_apply_data: (promotion) ->
    # Overrides PromotionViewModel
    promotion_id: promotion.id
    product_id: @productId
    product_type: @productType

  applyPromotion: (promotion, event) =>
    if confirm "Associate promotion?"
      $.post(@apply_promotion_path, @build_apply_data(promotion))
      .success (data) =>
        promotion.applied(true)
        @promotionNotification.text data.message
        @promotionNotification.success true
      .error (xhr) =>
        @promotionNotification.text $.parseJSON(xhr.responseText).error
        @promotionNotification.success false

  remove_promotion: (promotion, event) ->
    if confirm "Remove this promotion?"
      super promotion, event
