module ModelStats
  def self.current_model_object
    @object ||= ModelSwitch.current
  end

  def self.current_model_version
    current_model_object.version
  end

  def self.request model, action
    type = nil
    type = 'top_variables' if action == 'model_info'
    R::Request.fetch({}, model, action, type: type).response
  end
  
  def self.get_top_x_vars_from_R_server model, x
    request(model, 'model_info')['variables'][0..x]
  end
  
  def self.get model, for_vars = []
    @result ||= request(model, 'velocity_check')
    if for_vars.present?
      new_result = @result.deep_dup
      new_result.keys.each { |key| new_result[key] = new_result[key].slice(*for_vars) }
      new_result
    else
      @result
    end
  end
end
